# Maintainer: Spifuth <your-email@example.com>
pkgname=autovault
pkgver=2.8.0
pkgrel=1
pkgdesc="CLI tool for managing Obsidian vaults for customer documentation"
arch=('any')
url="https://github.com/Spifuth/AutoVault"
license=('MIT')
depends=('bash>=4.0' 'jq' 'rsync')
optdepends=(
    'fzf: for interactive menu selection'
    'age: for encryption support'
    'gnupg: for GPG encryption support'
    'git: for version control integration'
    'openssh: for remote sync features'
)
makedepends=('git')
source=("${pkgname}-${pkgver}.tar.gz::https://github.com/Spifuth/AutoVault/archive/refs/tags/v${pkgver}.tar.gz")
sha256sums=('SKIP')

package() {
    cd "AutoVault-${pkgver}"

    # Install main script
    install -Dm755 cust-run-config.sh "${pkgdir}/usr/bin/autovault"

    # Install bash scripts
    install -dm755 "${pkgdir}/usr/lib/autovault/bash"
    install -Dm755 bash/*.sh "${pkgdir}/usr/lib/autovault/bash/"
    
    install -dm755 "${pkgdir}/usr/lib/autovault/bash/lib"
    install -Dm644 bash/lib/*.sh "${pkgdir}/usr/lib/autovault/bash/lib/"
    chmod +x "${pkgdir}/usr/lib/autovault/bash/lib/"*.sh

    # Install config templates
    install -dm755 "${pkgdir}/usr/share/autovault/config"
    install -Dm644 config/*.json "${pkgdir}/usr/share/autovault/config/"

    # Install hook examples
    install -dm755 "${pkgdir}/usr/share/autovault/hooks"
    install -Dm644 hooks/*.example "${pkgdir}/usr/share/autovault/hooks/" 2>/dev/null || true
    install -Dm644 hooks/README.md "${pkgdir}/usr/share/autovault/hooks/"

    # Install documentation
    install -Dm644 README.md "${pkgdir}/usr/share/doc/${pkgname}/README.md"
    install -Dm644 CHANGELOG.md "${pkgdir}/usr/share/doc/${pkgname}/CHANGELOG.md"
    install -Dm644 docs/*.md "${pkgdir}/usr/share/doc/${pkgname}/"

    # Install shell completions
    install -Dm644 completions/autovault.bash "${pkgdir}/usr/share/bash-completion/completions/autovault"
    install -Dm644 completions/_autovault "${pkgdir}/usr/share/zsh/site-functions/_autovault"

    # Update script path
    sed -i 's|^SCRIPT_DIR=.*|SCRIPT_DIR="/usr/lib/autovault"|' "${pkgdir}/usr/bin/autovault"

    # Install license
    install -Dm644 LICENSE "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE" 2>/dev/null || true
}

# vim:set ts=4 sw=4 et:
