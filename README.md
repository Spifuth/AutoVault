# AutoVault

Helper scripts to create, template, verify, and clean a "Run" workspace in an Obsidian vault. Each customer gets a `CUST-XXX` folder with section subfolders, index files, and a global `Run-Hub.md` linking to every customer.

## Features

- **Structure generation** – Creates customer folders (`CUST-001`, `CUST-002`, …) with configurable section subfolders and a central `Run-Hub.md`
- **Template application** – Applies Markdown templates with placeholder substitution (`{{CUST_CODE}}`, `{{SECTION}}`, `{{NOW_UTC}}`, `{{NOW_LOCAL}}`)
- **Verification** – Validates folder structure, index files, and hub links
- **Cleanup** – Removes customer folders (protected by safety flags)
- **Cross-platform** – Parallel implementations in Bash and PowerShell

## Generated Structure

```
<VaultRoot>/
├── Run/
│   ├── CUST-002/
│   │   ├── CUST-002-Index.md
│   │   ├── CUST-002-FP/
│   │   │   └── CUST-002-FP-Index.md
│   │   ├── CUST-002-RAISED/
│   │   │   └── CUST-002-RAISED-Index.md
│   │   ├── CUST-002-INFORMATIONS/
│   │   │   └── CUST-002-INFORMATIONS-Index.md
│   │   └── CUST-002-DIVERS/
│   │       └── CUST-002-DIVERS-Index.md
│   └── ...
└── Run-Hub.md
```

## Requirements
- PowerShell 7+ (`pwsh`)
- Bash (for the orchestrator helper)

## Configure
1. Edit `cust-run-config.sh` (or the `.ps1` equivalent) and set:
   - `VAULT_ROOT` – path to your vault
   - `CUSTOMER_ID_WIDTH` – zero-padding width (default 3)
   - `CUSTOMER_IDS` – list of numeric customer codes
   - `SECTIONS` – section names (defaults to `FP RAISED INFORMATIONS DIVERS`)
   - `TEMPLATE_RELATIVE_ROOT` – relative path to templates (defaults to `_templates/Run`; use your OS path separators)
2. Run the config script; it will (re)write `cust-run-config.json` so Bash and PowerShell scripts share the same values.
3. Provide templates in `<VAULT_ROOT>/_templates/Run/` (POSIX) or `<VAULT_ROOT>\_templates\Run\` (Windows):
   - `CUST-Root-Index.md`
   - `CUST-Section-FP-Index.md`
   - `CUST-Section-RAISED-Index.md`
   - `CUST-Section-INFORMATIONS-Index.md`
   - `CUST-Section-DIVERS-Index.md`
   - Or generate them automatically from JSON (see "Generate templates from JSON").
4. `cust-run-config.json` is generated by the config scripts and used as the single source for both shells.

## Usage (preferred)
Run the orchestrator, which exports config and calls the PowerShell scripts:

```bash
VAULT_ROOT="/path/to/vault" CUSTOMER_IDS="1 2 3" ./cust-run-config.sh structure
```

PowerShell equivalents use the `CUST_` prefix:

| Bash | PowerShell |
|------|------------|
| `VAULT_ROOT` | `$env:CUST_VAULT_ROOT` |
| `CUSTOMER_ID_WIDTH` | `$env:CUST_CUSTOMER_ID_WIDTH` |
| `CUSTOMER_IDS` | `$env:CUST_CUSTOMER_IDS` |
| `SECTIONS` | `$env:CUST_SECTIONS` |
| `TEMPLATE_RELATIVE_ROOT` | `$env:CUST_TEMPLATE_RELATIVE_ROOT` |

## Safety Notes

### Cleanup protection

Cleanup is **disabled by default** to prevent accidental data loss. To enable deletions:

- **PowerShell**: Set `$EnableDeletion = $true` in `Cleanup-CustRunStructure.ps1`
- **Bash**: Set `ENABLE_DELETION=true` in `Cleanup-CustRunStructure.sh`

To also remove `Run-Hub.md`:

- **PowerShell**: Set `$RemoveHub = $true`
- **Bash**: Set `REMOVE_HUB=true`

### Direct script usage

Individual scripts in `bash/` and `powershell/` can be run directly after setting the required environment variables. The scripts will attempt to source configuration from `cust-run-config.sh` or fall back to `cust-run-config.json`.

## License

## Direct script entry points
If you do not want to use the orchestrator, you can run the individual Bash scripts (`New-*.sh`, `Apply-*.sh`, `Test-*.sh`, `Cleanup-*.sh`) after updating their inline configuration blocks. Matching PowerShell scripts exist for Windows users. When editing those inline blocks, keep them in sync with the values emitted to `cust-run-config.json` by `cust-run-config.sh`/`.ps1` so tests and structure generation use the same parameters.

## Generate templates from JSON
Use `Generate-CustRunTemplates.sh` (Bash) or `Generate-CustRunTemplates.ps1` (PowerShell) to populate the `_templates/Run` folder from a JSON description:

```json
{
  "Templates": [
    {"FileName": "CUST-Root-Index.md", "Content": "# {{CUST_CODE}} ..."},
    {"FileName": "CUST-Section-FP-Index.md", "Content": "# {{CUST_CODE}} | {{SECTION}} ..."}
  ]
}
```

* Default JSON path: `cust-run-templates.json` (you can copy-edit `cust-run-templates.sample.json`).
* Placeholders like `{{CUST_CODE}}`, `{{SECTION}}`, `{{NOW_UTC}}`, and `{{NOW_LOCAL}}` are left intact so `Apply-CustRunTemplates` can replace them when generating the customer-facing files.
* The scripts honor `VAULT_ROOT` and `TEMPLATE_RELATIVE_ROOT` from `cust-run-config` to decide where `_templates/Run` lives.
