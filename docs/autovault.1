.\" Manpage for autovault
.\" Contact: https://github.com/Spifuth/AutoVault
.TH AUTOVAULT 1 "December 2024" "AutoVault 2.0" "User Commands"
.SH NAME
autovault \- Obsidian Vault Structure Manager for SOC/RUN workflows
.SH SYNOPSIS
.B cust-run-config.sh
[\fIOPTIONS\fR] \fICOMMAND\fR [\fIARGS\fR]
.SH DESCRIPTION
.B AutoVault
is a CLI tool to manage Obsidian vault structures for SOC (Security Operations Center) 
RUN workflows. It creates and maintains a hierarchical folder structure for customer 
management with templates, indexes, and Dataview integration.
.PP
The tool manages:
.IP \(bu 2
Customer folders (CUST-001, CUST-002, etc.)
.IP \(bu 2
Section subfolders (FP, RAISED, INFORMATIONS, DIVERS)
.IP \(bu 2
Index files with Templater placeholders
.IP \(bu 2
Run-Hub master index with Dataview queries
.IP \(bu 2
Obsidian plugin configurations
.SH OPTIONS
.TP
.BR \-v ", " \-\-verbose
Enable verbose/debug output (LOG_LEVEL=4)
.TP
.BR \-q ", " \-\-quiet
Only show errors (LOG_LEVEL=1)
.TP
.B \-\-silent
Suppress all output (LOG_LEVEL=0)
.TP
.B \-\-no\-color
Disable colored output
.TP
.B \-\-dry\-run
Preview changes without applying them
.TP
.BR \-h ", " \-\-help
Show help message
.SH COMMANDS
.SS Configuration
.TP
.B config
Launch interactive configuration wizard. Prompts for vault path, customer IDs, 
sections, and other settings.
.TP
.B validate
Validate the configuration file syntax and values.
.TP
.B status
Display current configuration and vault status.
.SS Structure Management
.TP
.B structure
Create the folder structure in the vault. Creates Run/ directory with CUST-XXX 
folders, section subfolders, index files, and Run-Hub.md.
.TP
.B templates \fR[\fIsubcommand\fR]
Manage templates. Subcommands:
.RS
.IP \fBapply\fR 10
Apply templates to CUST folder index files (default)
.IP \fBsync\fR 10
Sync templates from JSON to vault/_templates/Run/
.IP \fBexport\fR 10
Export templates from vault to JSON
.RE
.TP
.B test
Verify the vault structure is correct.
.TP
.B cleanup
Remove the entire vault structure. \fBDANGEROUS!\fR Requires EnableCleanup=true 
in configuration.
.SS Customer Management
.TP
.B customer \fR[\fIsubcommand\fR] [\fIID\fR]
Manage customers. Subcommands:
.RS
.IP \fBlist\fR 10
List all configured customers (default)
.IP "\fBadd\fR \fIID\fR" 10
Add a new customer with the given ID
.IP "\fBremove\fR \fIID\fR" 10
Remove a customer by ID
.RE
.SS Section Management
.TP
.B section \fR[\fIsubcommand\fR] [\fINAME\fR]
Manage sections. Subcommands:
.RS
.IP \fBlist\fR 10
List all configured sections (default)
.IP "\fBadd\fR \fINAME\fR" 10
Add a new section to all customers
.IP "\fBremove\fR \fINAME\fR" 10
Remove a section from all customers
.RE
.SS Backup Management
.TP
.B backup \fR[\fIsubcommand\fR] [\fIARGS\fR]
Manage backups. Subcommands:
.RS
.IP \fBlist\fR 10
List all available backups (default)
.IP "\fBcreate\fR [\fIDESCRIPTION\fR]" 10
Create a manual backup
.IP "\fBrestore\fR \fINUMBER\fR" 10
Restore a backup by its number
.IP "\fBcleanup\fR [\fIN\fR]" 10
Remove old backups, keep N most recent
.RE
.SS Vault Management
.TP
.B vault \fR[\fIsubcommand\fR]
Obsidian vault setup. Subcommands:
.RS
.IP \fBinit\fR 10
Full vault initialization (default): structure + templates + plugins
.IP \fBplugins\fR 10
Configure Obsidian plugin settings
.IP \fBcheck\fR 10
Check if required plugins are installed
.IP \fBhub\fR 10
Regenerate Run-Hub.md with Dataview queries
.RE
.SS System
.TP
.B requirements \fR[\fIcheck\fR|\fIinstall\fR]
Check or install system dependencies (jq, python3).
.SH CONFIGURATION
Configuration is stored in \fBconfig/cust-run-config.json\fR:
.PP
.nf
{
  "VaultRoot": "/path/to/obsidian/vault",
  "CustomerIdWidth": 3,
  "CustomerIds": [1, 2, 3, 5, 10],
  "Sections": ["FP", "RAISED", "INFORMATIONS", "DIVERS"],
  "TemplateRelativeRoot": "_templates/Run",
  "EnableCleanup": false
}
.fi
.PP
Override the config file path with the \fBCONFIG_JSON\fR environment variable:
.PP
.nf
CONFIG_JSON=/path/to/config.json cust-run-config.sh status
.fi
.SH STRUCTURE
The tool creates the following structure in your Obsidian vault:
.PP
.nf
<VaultRoot>/
├── Run/
│   ├── CUST-001/
│   │   ├── CUST-001-Index.md
│   │   ├── CUST-001-FP/
│   │   │   └── CUST-001-FP-Index.md
│   │   ├── CUST-001-RAISED/
│   │   │   └── CUST-001-RAISED-Index.md
│   │   └── ...
│   ├── CUST-002/
│   │   └── ...
│   └── ...
├── Run-Hub.md
└── _templates/
    └── Run/
        ├── CUST-Root-Index.md
        ├── CUST-Section-FP-Index.md
        └── ...
.fi
.SH TEMPLATES
Templates use Templater syntax with the following placeholders:
.TP
.B {{CUST_CODE}}
Replaced with the customer code (e.g., CUST-001)
.TP
.B {{SECTION}}
Replaced with the section name (e.g., FP, RAISED)
.TP
.B <% tp.* %>
Templater plugin syntax for dynamic content
.PP
Templates are stored in \fBconfig/templates.json\fR and can be synced to the vault 
with \fBtemplates sync\fR.
.SH REQUIRED PLUGINS
AutoVault requires the following Obsidian plugins:
.TP
.B Templater
For processing template placeholders and folder templates
.TP
.B Dataview
For dynamic queries in Run-Hub.md
.PP
Use \fBvault check\fR to verify plugins are installed, and \fBvault plugins\fR 
to configure them automatically.
.SH EXAMPLES
.PP
First time setup:
.nf
cust-run-config.sh config
cust-run-config.sh vault init
.fi
.PP
Add a new customer:
.nf
cust-run-config.sh customer add 31
.fi
.PP
Preview cleanup without making changes:
.nf
cust-run-config.sh --dry-run cleanup
.fi
.PP
Sync templates and apply to all customers:
.nf
cust-run-config.sh templates sync
cust-run-config.sh templates apply
.fi
.SH ENVIRONMENT
.TP
.B CONFIG_JSON
Path to configuration file (default: config/cust-run-config.json)
.TP
.B DRY_RUN
Set to "true" to preview changes without applying
.TP
.B LOG_LEVEL
Logging verbosity: 0=silent, 1=error, 2=warn, 3=info, 4=debug
.TP
.B NO_COLOR
Set to disable colored output
.SH FILES
.TP
.I config/cust-run-config.json
Main configuration file
.TP
.I config/templates.json
Template definitions
.TP
.I config/obsidian-settings.json
Obsidian plugin settings
.TP
.I backups/
Backup storage directory
.SH EXIT STATUS
.TP
.B 0
Success
.TP
.B 1
General error or invalid command
.TP
.B 2
Configuration error
.SH BUGS
Report bugs at: https://github.com/Spifuth/AutoVault/issues
.SH AUTHOR
Spifuth <https://github.com/Spifuth>
.SH SEE ALSO
.BR obsidian (1),
.BR jq (1)
.PP
Full documentation: https://github.com/Spifuth/AutoVault/tree/main/docs
